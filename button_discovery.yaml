# Button Discovery for Shrooly Hardware
esphome:
  name: enhanced-openshrooly
  friendly_name: Enhanced OpenShrooly Button Discovery
  project:
    name: "enhanced.openshrooly"
    version: "2.2.0-buttons"

esp32:
  board: esp32-s3-devkitc-1
  framework:
    type: arduino
    version: recommended

logger:
  level: DEBUG

api:

ota:
  - platform: esphome

# WiFi configuration
wifi:
  ap:
    ssid: "Enhanced-OpenShrooly-Setup"
    password: "shrooly123"

captive_portal:

web_server:
  port: 80

# Correct I2C configuration for Shrooly
i2c:
  sda: GPIO36
  scl: GPIO35
  scan: true
  id: bus_a

# Correct SPI configuration for Shrooly display
spi:
  clk_pin: GPIO7
  mosi_pin: GPIO6

# Font for display
font:
  - file: fonts/arial.ttf
    id: font_medium
    size: 12
  - file: fonts/arial.ttf
    id: font_small
    size: 10

# Correct display configuration for Shrooly
display:
  - platform: waveshare_epaper
    id: my_display
    cs_pin: GPIO8
    dc_pin: GPIO48
    busy_pin: GPIO38
    reset_pin: GPIO21
    rotation: 90춿
    model: 2.90inv2-r2
    update_interval: 30s
    lambda: |-
      it.print(10, 10, id(font_medium), "BUTTON DISCOVERY");
      it.print(10, 30, id(font_small), "Press any button");
      it.print(10, 45, id(font_small), "Check serial log");
      it.print(10, 60, id(font_small), "for responses");
      
      // Show last pressed button
      static std::string last_button = "None";
      it.printf(10, 80, id(font_small), "Last: %s", last_button.c_str());

# Test ALL available GPIO pins as potential buttons
binary_sensor:
  # Known working button
  - platform: gpio
    pin:
      number: GPIO5
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO5 Reset"
    id: gpio5_button
    on_press:
      - logger.log: 
          format: "游댮 GPIO5 (Reset) PRESSED - WORKING!"
          level: ERROR

  # Test common button pins for ESP32-S3
  - platform: gpio
    pin:
      number: GPIO0
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO0 Test"
    id: gpio0_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO0 PRESSED - FOUND BUTTON!"
          level: ERROR
      - component.update: my_display

  - platform: gpio
    pin:
      number: GPIO1
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO1 Test"
    id: gpio1_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO1 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO2
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO2 Test"
    id: gpio2_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO2 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO3
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO3 Test"
    id: gpio3_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO3 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO4
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO4 Test"
    id: gpio4_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO4 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO9
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO9 Test"
    id: gpio9_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO9 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO10
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO10 Test"
    id: gpio10_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO10 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO11
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO11 Test"
    id: gpio11_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO11 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO12
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO12 Test"
    id: gpio12_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO12 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO13
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO13 Test"
    id: gpio13_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO13 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO14
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO14 Test"
    id: gpio14_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO14 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO15
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO15 Test"
    id: gpio15_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO15 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO16
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO16 Test"
    id: gpio16_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO16 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO17
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO17 Test"
    id: gpio17_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO17 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO18
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO18 Test"
    id: gpio18_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO18 PRESSED - FOUND BUTTON!"
          level: ERROR

  # Skip GPIO19-34 (used by other functions or not available)
  
  - platform: gpio
    pin:
      number: GPIO40
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO40 Test"
    id: gpio40_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO40 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO41
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO41 Test"
    id: gpio41_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO41 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO43
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO43 Test"
    id: gpio43_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO43 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO44
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO44 Test"
    id: gpio44_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO44 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO45
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO45 Test"
    id: gpio45_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO45 PRESSED - FOUND BUTTON!"
          level: ERROR

  - platform: gpio
    pin:
      number: GPIO46
      mode: INPUT_PULLUP
      inverted: true
    name: "GPIO46 Test"
    id: gpio46_button
    on_press:
      - logger.log: 
          format: "游릭 GPIO46 PRESSED - FOUND BUTTON!"
          level: ERROR

# Keep working hardware for reference
sensor:
  - platform: sht4x
    i2c_id: bus_a
    temperature:
      name: "Temperature"
      id: temperature
    humidity:
      name: "Humidity"  
      id: humidity
    update_interval: 10s

# Debug info
interval:
  - interval: 10s
    then:
      - logger.log: 
          format: "游댌 BUTTON DISCOVERY MODE - Press any button on the device"
          level: ERROR
      - logger.log:
          format: "游늵 Temperature: %.1f춿C, Humidity: %.1f%%"
          args: [ 'id(temperature).state', 'id(humidity).state' ]
          level: INFO